<div class="container">
    <h1>Employees</h1>

    <div class="card flex justify-content-end">
        <p-button label="Add Employee" icon="pi pi-plus" (click)="showDialog = true; prepareEmployee()"></p-button>
    </div>

    <table>
        <thead>
            <tr>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Email</th>
                <th>Password</th>
                <th>Phone Number</th>
                <th>Address</th>
                <th>Department</th>
                <th>Manager</th>
                <th>Employee Role</th>
                <th>Joining Date</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let employee of employees">
                <td>{{ employee.firstName }}</td>
                <td>{{ employee.lastName }}</td>
                <td>{{ employee.email }}</td>
                <td>{{ employee.password }}</td> <!-- Added Password Column -->
                <td>{{ employee.mobileNumber }}</td>
                <td>{{ employee.address }}</td>
                <td>{{ employee.department }}</td>
                <td>{{ employee.manager }}</td>
                <td>{{ employee.role }}</td>
                <td>{{ employee.joiningDate }}</td>
                <td>
                    <p-button icon="pi pi-pencil" class="p-button-rounded mx-2" (click)="editEmployee(employee)"></p-button>
                    <p-button icon="pi pi-trash" class="p-button-rounded" (click)="deleteEmployee(employee.id)"></p-button>
                </td>
            </tr>
        </tbody>
    </table>
    
    <!-- PrimeNG Dialog -->
    <p-dialog header="{{ isEditing ? 'Edit Employee' : 'Add Employee' }}" [(visible)]="showDialog" modal="modal"
        [style]="{'width': '50vw'}" [responsive]="true" [closable]="true">
        <form #employeeForm="ngForm" (ngSubmit)="isEditing ? updateEmployee() : addEmployee()">
            <div class="column">
                <div class="input-box">
                    <label>First Name</label>
                    <input type="text" [(ngModel)]="employee.firstName" name="firstName" placeholder="Enter first name"
                        #firstName="ngModel" required pattern="[A-Za-z]+" />
                    <div *ngIf="firstName.invalid && (firstName.dirty || firstName.touched)" class="error-message">
                        <div *ngIf="firstName.errors?.['required']">First name is required.</div>
                        <div *ngIf="firstName.errors?.['pattern']">First name must contain only letters.</div>
                    </div>
                </div>
                <div class="input-box">
                    <label>Last Name</label>
                    <input type="text" [(ngModel)]="employee.lastName" name="lastName" placeholder="Enter last name"
                        #lastName="ngModel" required pattern="[A-Za-z]+" />
                    <div *ngIf="lastName.invalid && (lastName.dirty || lastName.touched)" class="error-message">
                        <div *ngIf="lastName.errors?.['required']">Last name is required.</div>
                        <div *ngIf="lastName.errors?.['pattern']">Last name must contain only letters.</div>
                    </div>
                </div>
            </div>
            <div class="column">
                <div class="input-box">
                    <label>Email Address</label>
                    <input type="text" [(ngModel)]="employee.email" name="email" placeholder="Enter email address"
                        #email="ngModel" required 
                        pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$" />
                    <div *ngIf="email.invalid && (email.dirty || email.touched)" class="error-message">
                        <div *ngIf="email.errors?.['required']">Email address is required.</div>
                        <div *ngIf="email.errors?.['pattern']">Invalid email address format.</div>
                    </div>
                </div>
                <div class="input-box">
                    <label>Password</label>
                    <input type="password" [(ngModel)]="employee.password" name="password" placeholder="Enter password"
                        #password="ngModel" required 
                        pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}" />
                    <div *ngIf="password.invalid && (password.dirty || password.touched)" class="error-message">
                        <div *ngIf="password.errors?.['required']">Password is required.</div>
                        <div *ngIf="password.errors?.['pattern']">Password must be at least 8 characters long, contain at least one uppercase letter, one lowercase letter, one digit, and one special character.</div>
                    </div>
                </div>
            </div>
            <div class="column">
                <div class="input-box">
                    <label>Phone Number</label>
                    <input type="tel" [(ngModel)]="employee.mobileNumber" name="mobileNumber"
                        placeholder="Enter phone number" #mobileNumber="ngModel" required pattern="[0-9]{10}" />
                    <div *ngIf="mobileNumber.invalid && (mobileNumber.dirty || mobileNumber.touched)" class="error-message">
                        <div *ngIf="mobileNumber.errors?.['required']">Phone number is required.</div>
                        <div *ngIf="mobileNumber.errors?.['pattern']">Phone number must be 10 digits long.</div>
                    </div>
                </div>
                <div class="input-box">
                    <label>Department</label>
                    <div class="select-box">
                        <select [(ngModel)]="employee.department" name="department" placeholder="Select Department" #department="ngModel" required>
                            <option hidden>Department</option>
                            <option>Engineering</option>
                            <option>QA Testing</option>
                            <option>Admin</option>
                            <option>Human Resources</option>
                        </select>
                    </div>
                    <div *ngIf="department.invalid && (department.dirty || department.touched)" class="error-message">
                        <div *ngIf="department.errors?.['required']">Department is required.</div>
                    </div>
                </div>
                <div class="input-box">
                    <label>Manager</label>
                    <input type="text" [(ngModel)]="employee.manager" name="role" placeholder="Enter Manager Name"
                        #role="ngModel" required />
                    <div *ngIf="role.invalid && (role.dirty || role.touched)" class="error-message">
                        <div *ngIf="role.errors?.['required']">Manager Name is required.</div>
                    </div>
                </div>
                <div class="input-box">

                    <label>Role</label>
                    <div class="select-box">
                        <select [(ngModel)]="employee.role" name="role"  placeholder="Enter Role" #role="ngModel" required>
                            <option hidden>Role</option>
                            <option>Manager</option>
                            <option>HR</option>
                            <option>Admin</option>
                            <option>Developer</option>
                            <option>Tester</option>
                        </select>
                    </div>
                    <div *ngIf="role.invalid && (role.dirty || role.touched)" class="error-message">
                        <div *ngIf="role.errors?.['required']">Role is required.</div>
                    </div>
                </div>
                <div class="input-box">
                    <label>Joining Date</label>
                    <input type="date" [(ngModel)]="employee.joiningDate" name="joiningDate"
                        placeholder="Enter Joining Date" #joiningDate="ngModel" required />
                    <div *ngIf="joiningDate.invalid && (joiningDate.dirty || joiningDate.touched)" class="error-message">
                        <div *ngIf="joiningDate.errors?.['required']">Joining date is required.</div>
                    </div>
                </div>
            </div>
            <div class="input-box address">
                <label>Address</label>
                <input type="text" [(ngModel)]="employee.address" name="address" placeholder="Enter street address"
                    #address="ngModel" required />
                <div *ngIf="address.invalid && (address.dirty || address.touched)" class="error-message">
                    <div *ngIf="address.errors?.['required']">Address is required.</div>
                </div>
            </div>
            <div style="display: flex; justify-content: flex-end; margin-top: 1rem;">
                <p-button [label]="isEditing ? 'Update' : 'Save'" [disabled]="employeeForm.invalid"
                    (click)="isEditing ? updateEmployee() : addEmployee()"></p-button>
            </div>
        </form>
    </p-dialog>
</div>
