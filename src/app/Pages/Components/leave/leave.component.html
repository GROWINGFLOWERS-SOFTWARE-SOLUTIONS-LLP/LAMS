<p-toast></p-toast>

<div class="container h-screen">
  <div class="p-fluid">
    <div class="p-card">
      <h2 class="flex justify-content-left">New Leave Request</h2>
      <div class="flex justify-content-end mb-3">
        <p-button label="Leave Application Form" (onClick)="showDialog()"></p-button>
      </div>

      <!-- Dialog for the leave application form -->
      <p-dialog header="Leave Application Form" [(visible)]="visible" [modal]="true" [closable]="false"
        [style]="{ width: '50rem' }" [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }">
        <form [formGroup]="leaveForm">
          <div class="p-fluid grid">
             <!-- Start Date -->
             <div class="field col-12 lg:col-6">
              <label for="startDate">Start Date <span class="text-red-500">*</span></label>
              <p-calendar formControlName="startDate" [minDate]="today" [showIcon]="true" appendTo="body"
                dateFormat="yy-mm-dd"></p-calendar>
              <small *ngIf="leaveForm.get('startDate')?.invalid && leaveForm.get('startDate')?.touched" class="p-error">
                Start Date is required.
              </small>
            </div>

            <!-- End Date -->
            <div class="field col-12 lg:col-6">
              <label for="endDate">End Date <span class="text-red-500">*</span></label>
              <p-calendar formControlName="endDate" [minDate]="leaveForm.get('startDate')?.value || today"
                [showIcon]="true" appendTo="body" dateFormat="yy-mm-dd"></p-calendar>
              <small *ngIf="leaveForm.get('endDate')?.invalid && leaveForm.get('endDate')?.touched" class="p-error">
                End Date is required.
              </small>
            </div>

            <!-- Leave Type -->
            <div class="col-12 lg:col-6">
              <div class="p-field">
                <label for="leaveType">Leave Type <span class="text-red-500">*</span></label>
                <p-dropdown formControlName="leaveType" [options]="leaveTypes" placeholder="Select Leave Type"></p-dropdown>
                <small *ngIf="leaveForm.get('leaveType')?.invalid && leaveForm.get('leaveType')?.touched" class="p-error">Leave Type is required.</small>
              </div>
            </div>

            <!-- Total Leaves -->
            <div class="col-12 lg:col-6">
              <div class="p-field">
                <label for="totalLeaves">Total Leaves <span class="text-red-500">*</span></label>
                <input pInputText formControlName="totalLeaves" type="number" [readonly]="true" />
              </div>
            </div>
          </div>

          <!-- Reason -->
          <div class="col-12">
            <div class="p-field">
              <label for="reason">Reason</label>
              <textarea pInputTextarea formControlName="reason" rows="3"></textarea>
            </div>
          </div>
        </form>

        <!-- Dialog Footer -->
        <div class="p-dialog-footer flex justify-content-center gap-3 p-3">
          <p-button label="Cancel" icon="pi pi-times" class="p-button-text" (onClick)="visible = false"></p-button>
          <p-button label="Save" icon="pi pi-check" (onClick)="saveLeaveRequest()" [disabled]="!leaveForm.valid"></p-button>
        </div>
      </p-dialog>

      <!-- Table to display submitted leave requests -->
      <div class="mt-3">
        <p-table [value]="leaveRequests" [paginator]="true" [rows]="10" [scrollable]="true" 
        responsiveLayout="scroll" class="responsive-table">
          <ng-template pTemplate="header">
            <tr>
              <th>Start Date</th>
              <th>End Date</th>
              <th>Leave Type</th>
              <th>Total Leaves</th>
              <th>Status</th>
              <th>Reason</th>
            </tr>
          </ng-template>

          <ng-template pTemplate="body" let-request>
            <tr>
              <td>{{ request.startDate | date:'yyyy-MM-dd' }}</td>
              <td>{{ request.endDate | date:'yyyy-MM-dd' }}</td>
              <td>{{ request.leaveType }}</td>
              <td>{{ request.totalLeaves }}</td>
              <td><span class="p-tag p-tag-warning">Pending</span></td>
              <td>{{ request.reason }}</td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
  </div>
</div>
